@using Allup_Service.UI.Dtos
@model ContactDto
@{
    Layout = "_Layout";
}


<!--====== Breadcrumb Part Start ======-->

<div class="breadcrumb-area">
    <div class="container-fluid custom-container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
                <li class="breadcrumb-item active">Contact</li>
            </ol>
        </nav>
    </div> <!-- container -->
</div>

<!--====== Breadcrumb Part Ends ======-->
<!--====== Contact PART START ======-->
<div class="mapouter" style="position:relative;text-align:right;height:450px;width:100%;">
    <div class="gmap_canvas" style="overflow:hidden;background:none!important;height:450px;width:100%;">
        <iframe width="100%"
                height="450"
                id="gmap_canvas"
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2782.1853613497497!2d49.85394549999999!3d40.377190899999995!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x40307d079efb5163%3A0xc20aa51a5f0b5e01!2sCode%20Academy!5e1!3m2!1sen!2saz!4v1753161244738!5m2!1sen!2saz"
                frameborder="0"
                scrolling="no"
                marginheight="0"
                marginwidth="0"
                style="border:0;"
                allowfullscreen=""
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade">
        </iframe>
    </div>
</div>

<!--====== Contact PART ENDS ======-->
<!--====== Contact Part Start ======-->

<section class="contact-page pt-20">
    <div class="container-fluid custom-container">
        <div class="row">
            <div class="col-lg-7 col-xl-8">
                <div class="contact-form mt-30">
                    <h4 class="allup-title">Billing Address</h4>
                    <form id="contact-form" asp-controller="Contact" asp-action="Index">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="single-form">
                                    <input id="fullname" asp-for=Name type="text" name="name" placeholder="Your Name">
                                    <span class="error" id="nameError" asp-validation-for="Name" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="single-form">
                                    <input id="email" asp-for="Email" type="email" name="email" placeholder="Your Email">
                                    <span class="error" id="emailError" asp-validation-for="Email" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="single-form">
                                    <input id="subject" asp-for="Subject" type="text" name="subject" placeholder="Subject">
                                    <span class="error" id="subjectError" asp-validation-for="Subject" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="single-form">
                                    <textarea id="message" asp-for="Message" name="message" placeholder="Your Message"></textarea>
                                    <span class="error" id="messageError" asp-validation-for="Message" class="text-danger"></span>
                                </div>
                            </div>
                            <p class="form-message"></p>
                            <div class="col-md-12">
                                <div class="single-form">
                                    <button type="submit" class="main-btn main-btn-2">Send Message</button>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="single-form">
                                    <a asp-action="Detail" asp-controller="Message"  class="main-btn main-btn-2">Chat Message</a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="col-lg-5 col-xl-4">
                <div class="contact-info mt-30">
                    <h4 class="title">Contact Us</h4>
                    <p class="text">Claritas est etiam processus dynamicus, qui sequitur mutationem consuetudium lectorum. Mirum est notare quam littera gothica, quam nunc putamus parum claram anteposuerit litterarum formas human.</p>

                    <ul class="contact-info-block">
                        <li>
                            <div class="single-info">
                                <div class="info-icon-title d-flex align-item-center">
                                    <div class="info-icon">
                                        <i class="icon ion-map"></i>
                                    </div>
                                    <h5 class="info-title media-body">Address</h5>
                                </div>
                                <p>123 Main Street, Anytown, CA 12345 – USA</p>
                            </div>
                        </li>
                        <li>
                            <div class="single-info">
                                <div class="info-icon-title d-flex align-item-center">
                                    <div class="info-icon">
                                        <i class="icon ion-ios-telephone-outline"></i>
                                    </div>
                                    <h5 class="info-title media-body">Phone</h5>
                                </div>
                                <p>Mobile: (08) 123 456 789</p>
                                <p>Hotline: 1009 678 456</p>
                            </div>
                        </li>
                        <li>
                            <div class="single-info">
                                <div class="info-icon-title d-flex align-item-center">
                                    <div class="info-icon">
                                        <i class="icon ion-ios-email-outline"></i>
                                    </div>
                                    <h5 class="info-title media-body">Email</h5>
                                </div>
                                <p>yourmail@domain.com</p>
                                <p>support@hastech.company</p>
                            </div>
                        </li>
                    </ul>
                </div>
                <!-- Chatbox Button -->
                <button id="chatToggleBtn" class="chat-toggle-btn">
                    💬 Live Chat
                </button>

                <!-- Chatbox Container -->
                <div id="chatBox" class="chat-box">
                    <div class="chat-header">
                        <span>AI Support</span>
                        <button id="chatCloseBtn" class="close-btn">×</button>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <!-- Burada mesajlar görünəcək -->
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chatInputField" placeholder="Type your message..." />
                        <button id="chatSendBtn">Send</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
</section>

<!--====== Contact Part Ends ======-->
<!--====== Brand Part Start ======-->

<div class="brand-area pt-80">
    <div class="container-fluid custom-container">
        <div class="row brand-active">
            <div class="col-lg-2">
                <div class="single-brand">
                    <a href="#">
                        <img src="assets/images/brand/brand-1.jpg" alt="brand">
                    </a>
                </div> <!-- single brand -->
            </div>
            <div class="col-lg-2">
                <div class="single-brand">
                    <a href="#">
                        <img src="assets/images/brand/brand-2.jpg" alt="brand">
                    </a>
                </div> <!-- single brand -->
            </div>
            <div class="col-lg-2">
                <div class="single-brand">
                    <a href="#">
                        <img src="assets/images/brand/brand-3.jpg" alt="brand">
                    </a>
                </div> <!-- single brand -->
            </div>
            <div class="col-lg-2">
                <div class="single-brand">
                    <a href="#">
                        <img src="assets/images/brand/brand-4.jpg" alt="brand">
                    </a>
                </div> <!-- single brand -->
            </div>
            <div class="col-lg-2">
                <div class="single-brand">
                    <a href="#">
                        <img src="assets/images/brand/brand-5.jpg" alt="brand">
                    </a>
                </div> <!-- single brand -->
            </div>
            <div class="col-lg-2">
                <div class="single-brand">
                    <a href="#">
                        <img src="assets/images/brand/brand-6.jpg" alt="brand">
                    </a>
                </div> <!-- single brand -->
            </div>
            <div class="col-lg-2">
                <div class="single-brand">
                    <a href="#">
                        <img src="assets/images/brand/brand-4.jpg" alt="brand">
                    </a>
                </div> <!-- single brand -->
            </div>
        </div> <!-- row -->
    </div> <!-- container -->
</div>

<!--====== Brand Part Ends ======-->
<!--====== Features Banner Part Start ======-->

<section class="features-banner-area pt-80 pb-100">
    <div class="container-fluid custom-container">
        <div class="features-banner-wrapper d-flex flex-wrap">
            <div class="single-features-banner d-flex">
                <div class="banner-icon">
                    <img src="assets/images/banner-icon/icon1.png" alt="Icon">
                </div>
                <div class="banner-content media-body">
                    <h3 class="banner-title">Free Shipping</h3>
                    <p>Free shipping on all US order</p>
                </div>
            </div> <!-- single features banner -->
            <div class="single-features-banner d-flex">
                <div class="banner-icon">
                    <img src="assets/images/banner-icon/icon2.png" alt="Icon">
                </div>
                <div class="banner-content media-body">
                    <h3 class="banner-title">Support 24/7</h3>
                    <p>Contact us 24 hours a day</p>
                </div>
            </div> <!-- single features banner -->
            <div class="single-features-banner d-flex">
                <div class="banner-icon">
                    <img src="assets/images/banner-icon/icon3.png" alt="Icon">
                </div>
                <div class="banner-content media-body">
                    <h3 class="banner-title">100% Money Back</h3>
                    <p>You have 30 days to Return</p>
                </div>
            </div> <!-- single features banner -->
            <div class="single-features-banner d-flex">
                <div class="banner-icon">
                    <img src="assets/images/banner-icon/icon4.png" alt="Icon">
                </div>
                <div class="banner-content media-body">
                    <h3 class="banner-title">90 Days Return</h3>
                    <p>If goods have problems</p>
                </div>
            </div> <!-- single features banner -->
            <div class="single-features-banner d-flex">
                <div class="banner-icon">
                    <img src="assets/images/banner-icon/icon5.png" alt="Icon">
                </div>
                <div class="banner-content media-body">
                    <h3 class="banner-title">Payment Secure</h3>
                    <p>We ensure secure payment</p>
                </div>
            </div> <!-- single features banner -->
        </div> <!-- features banner wrapper -->
    </div> <!-- container -->
</section>

<!--====== Features Banner Part Ends ======-->

<style>
    /* Chatbox Toggle Button */
    .chat-toggle-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #007bff;
        color: #fff;
        border: none;
        border-radius: 50px;
        padding: 12px 20px;
        font-size: 16px;
        cursor: pointer;
        z-index: 999;
    }

    /* Chatbox */
    .chat-box {
        display: none;
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 320px;
        height: 400px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 12px;
        box-shadow: 0px 4px 10px rgba(0,0,0,0.15);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    /* Header */
    .chat-header {
        background: #007bff;
        color: white;
        padding: 10px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    /* Close button */
    .close-btn {
        background: transparent;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
    }

    /* Messages */
    .chat-messages {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        font-size: 14px;
    }

    /* Input */
    .chat-input {
        display: flex;
        border-top: 1px solid #ddd;
    }

        .chat-input input {
            flex: 1;
            border: none;
            padding: 10px;
        }

        .chat-input button {
            background: #007bff;
            border: none;
            color: white;
            padding: 0 15px;
            cursor: pointer;
        }

</style>


<script>
     document.addEventListener('DOMContentLoaded', (event) => {
        var message = '@TempData["message"]'

        if (message) {

        Toastify({
            text: message,
            duration: 3000,
            destination: "https://github.com/apvarun/toastify-js",
            newWindow: true,
            close: true,
            gravity: "bottom",
            position: "right",
            stopOnFocus: true,
            style: {
                background: "#c93",
            },

        }).showToast();
        }




    });
</script>

<script>
    const chatToggleBtn = document.getElementById("chatToggleBtn");
    const chatBox = document.getElementById("chatBox");
    const chatCloseBtn = document.getElementById("chatCloseBtn");
    const chatSendBtn = document.getElementById("chatSendBtn");
    const chatMessages = document.getElementById("chatMessages");
    const chatInputField = document.getElementById("chatInputField");

    // Açmaq
    chatToggleBtn.addEventListener("click", () => {
        chatBox.style.display = "flex";
        chatToggleBtn.style.display = "none";
    });

    // Bağlamaq
    chatCloseBtn.addEventListener("click", () => {
        chatBox.style.display = "none";
        chatToggleBtn.style.display = "block";
    });

    // Mesaj göndərmək
    chatSendBtn.addEventListener("click", sendMessage);

    // Enter klavişi ilə göndərmək
    chatInputField.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
            sendMessage();
        }
    });

    async function sendMessage() {
        const msg = chatInputField.value.trim();
        if (msg !== "") {
            // İstifadəçi mesajını əlavə et
            addMessage("👤 " + msg, "user");
            chatInputField.value = "";

            // Yükləmə mesajını göstər
            const loadingMsg = addMessage("🤖 Cavab hazırlanır...", "bot", true);

            try {
                console.log("Backend-ə sorğu göndərilir...");

                const response = await fetch('/api/chat/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: msg })
                });

                console.log("Cavab alındı:", response.status);

                const data = await response.json();
                console.log("Cavab məlumatları:", data);

                // Yükləmə mesajını sil
                if (loadingMsg && loadingMsg.parentNode) {
                    loadingMsg.parentNode.removeChild(loadingMsg);
                }

                if (!response.ok) {
                    // Xəta mesajını göstər
                    addMessage("❌ Xəta: " + (data.error || data.details || 'Naməlum xəta'), "error");
                } else {
                    // AI cavabını əlavə et
                    addMessage("🤖 " + data.message, "bot");
                }
            } catch (error) {
                console.error("Xəta baş verdi:", error);

                // Yükləmə mesajını sil
                if (loadingMsg && loadingMsg.parentNode) {
                    loadingMsg.parentNode.removeChild(loadingMsg);
                }

                // Xəta mesajını göstər
                addMessage("❌ Şəbəkə xətası: " + error.message, "error");
            }
        }
    }

    function addMessage(text, type, isTemporary = false) {
        const msgElement = document.createElement("div");
        msgElement.textContent = text;

        if (type === "user") {
            msgElement.style.textAlign = "right";
            msgElement.style.backgroundColor = "#007bff";
            msgElement.style.color = "white";
        } else if (type === "bot") {
            msgElement.style.textAlign = "left";
            msgElement.style.backgroundColor = "#f1f1f1";
            msgElement.style.color = "#333";
        } else if (type === "error") {
            msgElement.style.textAlign = "left";
            msgElement.style.color = "red";
            msgElement.style.backgroundColor = "#ffe6e6";
        }

        msgElement.style.margin = "5px 0";
        msgElement.style.padding = "8px 12px";
        msgElement.style.borderRadius = "12px";
        msgElement.style.maxWidth = "80%";
        msgElement.style.wordWrap = "break-word";

        if (type === "user") {
            msgElement.style.marginLeft = "auto";
        }

        chatMessages.appendChild(msgElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        return isTemporary ? msgElement : null;
    }
</script>

<script>
    document.getElementById("contact-form").addEventListener("submit", function (e) {
      e.preventDefault();

      let isValid = true;

      // Clear previous errors
      document.querySelectorAll(".error").forEach(el => el.innerText = "");

      const name = document.getElementById("fullname").value.trim();
      const email = document.getElementById("email").value.trim();
      const phone = document.getElementById("subject").value.trim();
      const message = document.getElementById("message").value.trim();

      if (name === "") {
        document.getElementById("nameError").innerText = "Fullname is required.";
        isValid = false;
      }

      if (email === "") {
        document.getElementById("emailError").innerText = "Email is required.";
        isValid = false;
      }

      if (phone === "") {
        document.getElementById("subjectError").innerText = "Subject is required.";
        isValid = false;
      }

      if (message === "") {
        document.getElementById("messageError").innerText = "Message is required.";
        isValid = false;
      }

      if (isValid) {
           Swal.fire({
      title: 'Təşəkkür edirik!',
      text: 'Mesajınız uğurla göndərildi.',
      icon: 'success',
      confirmButtonText: 'Bağla'
    }).then((result) => {
      if (result.isConfirmed) {
        document.getElementById("contact-form").submit(); // Bu POST göndərəcək
      }
    });

      }
    });
</script>
