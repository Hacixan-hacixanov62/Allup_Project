@using Allup_Service.UI.Dtos
@model ShopDto

<!--====== Breadcrumb Part Start ======-->
<div class="breadcrumb-area">
    <div class="container-fluid custom-container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
                <li class="breadcrumb-item active">Shop</li>
            </ol>
        </nav>
    </div> <!-- container -->
</div>

<!--====== Breadcrumb Part Ends ======-->
<!--====== Shop Left sidebar Part Start ======-->

<section class="shop-area pt-20">
    <div class="container-fluid custom-container">
        <div class="row flex-md-row-reverse justify-content-end">
            <div class="col-lg-9">
                <div class="banner-image banner-2 mt-30">
                    <img src="~/assets/images/banner-13.jpg" alt="banner">
                </div> <!-- banner image -->

                <div class="shop-header">
                    <div class="row align-items-center">
                        <div class="col-sm-6">
                            <div class="shop-header-left d-flex flex-wrap align-items-center">
                                <div class="shop-header-icon">
                                    <ul class="nav" id="myTab" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <a class="active" id="grid-tab" data-toggle="tab" href="#grid" role="tab" aria-controls="grid" aria-selected="true"><i class="icon ion-grid show_grid"></i></a>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <a id="list-tab" data-toggle="tab" href="#list" role="tab" aria-controls="list" aria-selected="false"><i class="icon ion-android-menu show_list"></i></a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="shop-header-message">
                                    <p>Showing 1 to @Model.Products.Count of 15 (2 Pages)</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="shop-header-right d-flex flex-wrap align-items-center justify-content-sm-end">
                                <div class="shop-header-select d-flex flex-wrap">
                                    <span class="select-title">Show:</span>
                                    <select>
                                        <option value="1">10</option>
                                        <option value="2">20</option>
                                        <option value="3">30</option>
                                        <option value="4">40</option>
                                    </select>
                                </div>
                                <div class="shop-header-select">
                                    <span class="select-title">Sort By:</span>
                                    <form method ="get" action="@Url.Action("Index", "Shop")">
                                        <select id="sortOrderSelect" name="sortOrder" class="form-control" onchange="this.form.submit()">
                                            <option value="1">Default</option>
                                            <option value="A_to_Z">Sort by Name: A to Z</option>
                                            <option value="Z_to_A">Sort by Name: Z to A</option>
                                            <option value="PriceLowToHigh">Sort by Price: Low to High</option>
                                            <option value="PriceHighToLow">Sort by Price: High to Low</option>
                                        </select>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div> <!-- row -->
                </div> <!-- shop header -->
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="grid" role="tabpanel" aria-labelledby="grid-tab">
                        <div class="row">
                            @if(Model.Products.Count > 0)
                            {
                                @foreach (var product in Model.Products)
                                {
                                    <div class="product-col col-md-4 col-sm-6 products">
                                        <div class="single-product mt-30">
                                            <div class="product-image">
                                                <a asp-action="Detail" asp-route-id="@product.Id">
                                                    <img class="first-image" src="@product.MainFileUrl" alt="product">
                                                    <img class="second-image" src="@product.ProductImages.Where(pi => pi.IsCover == false).FirstOrDefault().ImageUrl" alt="product">
                                                </a>
                                                <ul class="product-meta">
                                                    <li><a href="#"><i class="icon ion-bag"></i></a></li>
                                                    <li><a href="#"><i class="icon ion-android-favorite-outline"></i></a></li>
                                                    <li><a href="#"><i class="icon ion-android-options"></i></a></li>
                                                    <li><a data-toggle="modal" data-target="#productQuickModal" href="#"><i class="icon ion-android-open"></i></a></li>
                                                </ul>
                                                <span class="discount-product">-@product.DiscountPercent%</span>
                                            </div>
                                            <div class="product-content">
                                                <h4 class="product-title"><a href="single-product.html">@product.Name</a></h4>
                                                <ul class="product-rating">
                                                    <li class="rating-on"><i class="fas fa-star"></i></li>
                                                    <li class="rating-on"><i class="fas fa-star"></i></li>
                                                    <li class="rating-on"><i class="fas fa-star"></i></li>
                                                    <li class="rating-on"><i class="fas fa-star"></i></li>
                                                    <li class="rating-on"><i class="fas fa-star"></i></li>
                                                </ul>
                                                <div class="product-price">
                                                    <span class="regular-price">€@product.CostPrice</span>
                                                    <span class="price-sale">€@product.SalePrice</span>
                                                </div>
                                                <p>@product.Desc</p>
                                            </div>
                                        </div> <!-- single product -->
                                    </div>
                                }

                            }
                            else
                            {
                                <li><h2>Product Not Found</h2></li>
                            }
                        </div> <!-- row -->
                    </div>
                    @* <div class="tab-pane fade" id="list" role="tabpanel" aria-labelledby="list-tab">
                        @if(Model.Products.Count >0)
                        {
                            @foreach (var product in Model.Products)
                            {
                                <div class="single-product-list mt-30">
                                    <div class="row">
                                        <div class="col-sm-5 col-xl-3">
                                            <div class="product-image">
                                                <a href="single-product.html">
                                                    <img class="first-image" src="@product.ProductImages.Where(pi => pi.IsCover == false).FirstOrDefault().ImageUrl" alt="product">
                                                    <img class="second-image" src="@product.MainFileUrl" alt="product">
                                                </a>
                                                <span class="discount-product">-@product.DiscountPercent%</span>
                                            </div>
                                        </div>
                                        <div class="col-sm-7 col-xl-9">
                                            <div class="product-content">
                                                <ul class="product-rating">
                                                    <li class="rating-on"><i class="fas fa-star"></i></li>
                                                    <li class="rating-on"><i class="fas fa-star"></i></li>
                                                    <li class="rating-on"><i class="fas fa-star"></i></li>
                                                    <li class="rating-on"><i class="fas fa-star"></i></li>
                                                    <li class="rating-on"><i class="fas fa-star"></i></li>
                                                </ul>
                                                <h4 class="product-title"><a asp-action="Detail" asp-controller="Shop">@product.Name</a></h4>
                                                <span class="availability">Availability: 299 In Stock</span>
                                                <div class="product-price">
                                                    <span class="regular-price">€@product.CostPrice</span>
                                                    <span class="price-sale">€@product.SalePrice</span>
                                                </div>
                                                <p>@product.Desc</p>
                                                <ul class="product-meta">
                                                    <li><a href="#"><i class="icon ion-bag"></i></a></li>
                                                    <li><a href="#"><i class="icon ion-android-favorite-outline"></i></a></li>
                                                    <li><a href="#"><i class="icon ion-android-options"></i></a></li>
                                                    <li><a data-toggle="modal" data-target="#productQuickModal" href="#"><i class="icon ion-android-open"></i></a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <li><h2>Product Not Found</h2></li>
                        }
                        <!-- single product List -->
                    </div> *@
                </div> <!-- Tab Content -->


                <ul class="pagination justify-content-center mt-30">
                    <li><a href="#"><i class="fal fa-chevron-left"></i></a></li>
                    <li class="active"><a href="#">1</a></li>
                    <li><a href="#">2</a></li>
                    <li><a href="#">3</a></li>
                    <li><a href="#"><i class="fal fa-chevron-right"></i></a></li>
                </ul>
            </div>

            <div class="col-lg-3">
                <div class="shop-sidebar">
                    <div class="shop-sidebar-widget mt-30">
                        <h5 class="shop-sidebar-title">Laptop</h5>
                        <div class="accordion" id="accordionExample">
                             <div class="card-header" id="headingOne">
                                    <a href="#" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Hot Category</a>
                                </div>                          
                              <div class="card">                              
                                <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                                   <div class="card-body">
                                        @foreach (var category in Model.Categories)
                                        {
                                              <ul class="category-list">                                           
                                            <li><a href="#">@category.Name</a></li>
                                        </ul>
                                      
                                        }
                                    </div>
                                    
                                </div>
                                
                            </div> <!-- card -->
                            
                     

                        </div> <!-- accordion -->
                    </div> <!-- Shop sidebar Category -->

                    <div class="shop-sidebar-widget mt-30">
                        <form method="get" asp-controller="Shop" asp-action="Index">
                            <h5 class="shop-sidebar-title">Color</h5>
                            <ul class="color-list">
                                @foreach (var color in Model.Colors)
                                {
                                    <li>
                                        <label>
                                            <input type="checkbox" name="SelectedColor" value="@color.Id"
                                                   @(Model.SelectedColor?.Contains(color.Id) == true ? "checked" : "") />
                                            @color.Name
                                        </label>
                                    </li>
                                }
                            </ul>
                        </form>

                    </div> <!-- Shop sidebar color -->

                    <div class="shop-sidebar-widget mt-30">
                        <h5 class="shop-sidebar-title">Compositions</h5>
                        <ul class="compositions-list">
                            <li>
                                <span class="custom-checkbox">
                                    <input type="checkbox" id="compositions1">
                                    <label for="compositions1"></label>
                                    <a href="#">Cotton(3)</a>
                                </span>
                            </li>
                            <li>
                                <span class="custom-checkbox">
                                    <input type="checkbox" id="compositions2">
                                    <label for="compositions2"></label>
                                    <a href="#">Elastane(3)</a>
                                </span>
                            </li>
                            <li>
                                <span class="custom-checkbox">
                                    <input type="checkbox" id="compositions3">
                                    <label for="compositions3"></label>
                                    <a href="#">Polyester(3)</a>
                                </span>
                            </li>
                            <li>
                                <span class="custom-checkbox">
                                    <input type="checkbox" id="compositions4">
                                    <label for="compositions4"></label>
                                    <a href="#">Wool(3)</a>
                                </span>
                            </li>
                        </ul>
                    </div> <!-- Shop sidebar color -->

                    <div class="shop-sidebar-widget mt-30">
                        <h5 class="shop-sidebar-title">Price</h5>
                        <div class="price-range">
                            <div id="slider-range"></div>

                            <div class="range-slider mt-3">
                                <label for="amount">Price:</label>
                                <input type="text" id="amount" readonly style="border:0; color:#f6931f; font-weight:bold;">
                            </div>

                            <!-- Gizli inputlar: JS ilə dəyişəcək və lazım olsa forma üçün istifadə edilə bilər -->
                            <input type="hidden" name="minPrice" id="minPriceInput" value="@Model.SelectedMinPrice ?? 0" />
                            <input type="hidden" name="maxPrice" id="maxPriceInput" value="@Model.SelectedMaxPrice ?? 1000" />
                        </div>
                    </div>

                    <!-- Shop sidebar color -->

                    <div class="shop-sidebar-widget mt-30">
                        <h5 class="shop-sidebar-title">Size</h5>
                        <ul class="size-list">
                            @foreach (var size in Model.Sizes)
                            {
                                <li>
                                    <label>
                                        <input type="checkbox" name="SelectedSize" value="@size.Id"
                                               @(Model.SelectedSize?.Contains(size.Id) == true ? "checked" : "") />
                                        @size.Name
                                    </label>
                                </li>
                            }
                        </ul>

                        
                    </div> <!-- Shop sidebar Size -->

                    <div class="banner-image banner-2 mt-30">
                        <a href="#"><img src="~/assets/images/banner-10.jpg" alt="banner"></a>
                    </div> <!-- banner image -->
                </div> <!-- Shop sidebar -->
            </div>
        </div> <!-- row -->
    </div> <!-- container -->
</section>

<!--====== Shop Left sidebar Part Ends ======-->
@* 
@section scripts{
    <script src="~/assets/js/shop/sorts.js"></script>
} *@
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">


@section scripts{

    @*Asagdaki script Hissesi Shopdaki Produclari Refressiz islemek ucundur*@
    <script>
        const sortSelect = document.getElementById("sortOrderSelect");
        const productArea = document.querySelector('.products');
        const ProductCount = document.querySelector('.ProductCount');

        sortSelect.addEventListener("change", async function () {
            const sortOrder = this.value;

            const response = await fetch(`/Shop/Index?sortOrder=${sortOrder}`, {
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            });

            const data = await response.json();

            productArea.innerHTML = "";

            data.products.forEach(product => {
                const mainImg = product.productImgs.find(x => x.isMain === true);
                const price = product.discount > 0
                    ? product.price - (product.price * product.discount / 100)
                    : product.price;
                const fixedPrice = price.toFixed(2);

                productArea.innerHTML += `
                    <li class="products-block">
                        <a href="/Shop/Detail/${product.id}" class="product-link">
                            <img class="img-responsive" src="${mainImg?.url}" alt="${product.name}">
                            <div class="info-wrapper">
                                <div class="btn-add-to-cart">
                                    <a href="/Basket/AddToCart/${product.id}" class="btn cart-btn">Add to cart</a>
                                </div>
                                <h2 class="product-title">${product.name}</h2>
                                <span class="price">$${fixedPrice}</span>
                            </div>
                        </a>
                    </li>
                `;
            });

            ProductCount.innerText = data.count;
        });
    </script>

    @*Asagdaki hisse Shopun Price filtiridi*@
    <script>
        $(function () {
            let minVal = parseFloat($("#minPriceInput").val()) || 0;
            let maxVal = parseFloat($("#maxPriceInput").val()) || 1000;

            $("#slider-range").slider({
                range: true,
                min: 0,
                max: 1000,
                step: 10,
                values: [minVal, maxVal],
                slide: function (event, ui) {
                    $("#amount").val("$" + ui.values[0] + " - $" + ui.values[1]);
                    $("#minPriceInput").val(ui.values[0]);
                    $("#maxPriceInput").val(ui.values[1]);
                },
                change: function (event, ui) {
                    let min = ui.values[0];
                    let max = ui.values[1];

                    fetch(`/Shop/FilterByPrice?min=${min}&max=${max}`)
                        .then(res => {
                            if (!res.ok) {
                                throw new Error(`HTTP error! status: ${res.status}`);
                            }
                            return res.json();
                        })
                        .then(data => {
                            const container = document.querySelector(".row");
                            container.innerHTML = "";

                            if (!data || data.length === 0) {
                                container.innerHTML = "<h4 class='text-danger'>No products found in this range.</h4>";
                                return;
                            }

                            data.forEach(product => {
                                const image = product.productImages.find(x => x.isMain)?.imageUrl || '';
                                const secondImage = product.productImages.find(x => !x.isMain)?.imageUrl || image;

                                container.innerHTML += `
                                    <div class="product-col col-md-4 col-sm-6 products">
                                        <div class="single-product mt-30">
                                            <div class="product-image">
                                                <a href="/Shop/Detail/${product.id}">
                                                    <img class="first-image" src="${image}" alt="${product.name}">
                                                    <img class="second-image" src="${secondImage}" alt="${product.name}">
                                                </a>
                                                <ul class="product-meta">
                                                    <li><a href="#"><i class="icon ion-bag"></i></a></li>
                                                    <li><a href="#"><i class="icon ion-android-favorite-outline"></i></a></li>
                                                    <li><a href="#"><i class="icon ion-android-options"></i></a></li>
                                                    <li><a data-toggle="modal" data-target="#productQuickModal" href="#"><i class="icon ion-android-open"></i></a></li>
                                                </ul>
                                                <span class="discount-product">-${product.discountPercent}%</span>
                                            </div>
                                            <div class="product-content">
                                                <h4 class="product-title"><a href="/Shop/Detail/${product.id}">${product.name}</a></h4>
                                                <div class="product-price">
                                                    <span class="regular-price">€${product.costPrice}</span>
                                                    <span class="price-sale">€${product.salePrice}</span>
                                                </div>
                                                <p>${product.desc}</p>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            });
                        })
                        .catch(err => {
                            console.error("Price filter error:", err);
                            const container = document.querySelector(".row");
                            container.innerHTML = "<h4 class='text-danger'>Something went wrong. Please try again.</h4>";
                        });
                }
            });

            // İlk yükləmə zamanı göstəriş üçün inputa yaz
            $("#amount").val("$" + minVal + " - $" + maxVal);
        });
    </script>


}

