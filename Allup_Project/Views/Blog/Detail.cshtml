@using Allup_Service.UI.Vm
@model BlogDetailVM
@{
    Layout = "_Layout";
}
    <!--====== Breadcrumb Part Start ======-->

<div class="breadcrumb-area">
    <div class="container-fluid custom-container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
                <li class="breadcrumb-item"><a asp-controller="Blog" asp-action="Index">Blog</a></li>
                <li class="breadcrumb-item active">Blog Single</li>
            </ol>
        </nav>
    </div> <!-- container -->
</div>

<!--====== Breadcrumb Part Ends ======-->
<!--====== Blog Part Start ======-->

<section class="blog-page pt-20">
    <div class="container-fluid custom-container">
        <div class="row">
            <div class="col-lg-9">
                <div class="blog-single-posts mt-30">
                    <div class="blog-single-image">
                        <img src="@Model.Blog.ImageUrl" alt="blog">
                    </div>
                    <div class="blog-single-content">
                        <h4 class="blog-title">@Model.Blog.Title</h4>
                        <ul class="blog-meta">
                            <li><a href="#"><i class="fas fa-user-circle"></i> @Model.Blog.Author.Name</a></li>
                            <li><a href="#"><i class="fas fa-calendar-alt"></i> @Model.Blog.CreatedAt</a></li>
                        </ul>
                        <p>@Model.Blog.MinDescription</p>
                        <blockquote class="blockquote">
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, do eiusmod tempor incididunt ut labore et dolore magna aliqua. Duis aute irure dolor in rep rehenderit. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiumod tempor incididunt ut labore et dolore magna aliqua. Lorem ipsum dolor sit amet, consectetur adipisicing elit, do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                        </blockquote>
                        <p>@Model.Blog.MaxDescription</p>
                    </div>
                    <div class="blog-single-tags-share d-sm-flex justify-content-between">
                        <div class="blog-single-tags d-flex">
                            <span class="title">Tags: </span>
                            <ul class="tag-list">                                
                                <li><a href="#">@Model.Blog.Tag.Name,</a></li>
                            </ul>
                        </div>
                        <div class="blog-single-share d-flex">
                            <span class="title">Share:</span>
                            <ul class="social">
                                <li><a href="#"><i class="fab fa-facebook-f"></i></a></li>
                                <li><a href="#"><i class="fab fa-twitter"></i></a></li>
                                <li><a href="#"><i class="fab fa-instagram"></i></a></li>
                                <li><a href="#"><i class="fab fa-linkedin-in"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div> <!-- blog single posts -->
                <div class="blog-single-related-post pt-50">
                    <div class="section-title text-center">
                        <h2 class="title">Related Post</h2>
                    </div>
                    <div class="row">
                       @foreach (var item in Model.RelatedPosts)
                        {
                            <div class="col-md-4">
                                <div class="single-blog-post blog-grid-post related-post mt-30">
                                    <div class="blog-post-media">
                                        <div class="blog-image">
                                            <a href="blog-single-left-sidebar.html"><img src="@item.ImageUrl" alt="blog"></a>
                                        </div>
                                    </div>
                                    <div class="blog-post-content">
                                        <h4 class="blog-title"><a href="blog-single-left-sidebar.html">@item.Title</a></h4>
                                        <ul class="blog-meta">
                                            <li><a href="#"><i class="fas fa-user-circle"></i>@item.Author.Name</a></li>
                                            <li><a href="#"><i class="fas fa-calendar-alt"></i> @item.CreatedAt</a></li>
                                        </ul>
                                    </div>
                                </div> <!-- single blog post -->
                            </div>
                        }
                    </div>
                </div>
                <div class="blog-single-comment">
                    <div class="blog-comments">
                        <h4 class="comment-title">3 Comments</h4>
                       @if (Model.BlogComments.Any())
                       {
                            <ul class="comments-list">
                              @foreach (var comment in Model.BlogComments)
                              {
                                    <li>
                                        <div class="single-comment d-sm-flex">
                                            <div class="comment-author">
                                                <img src="assets/images/comment-author.jpg" alt="author">
                                            </div>
                                            <div class="comment-content media-body">
                                                <div class="comment-meta">
                                                    <h5 class="author-name">@comment.AppUser.Username</h5>
                                                    <span class="date">@comment.CreatedAt.ToString("g")</span>
                                                </div>
                                                <p>@comment.Text</p>
                                            @*     @if (User.Identity.IsAuthenticated && (User.IsInRole("Admin") || User.FindFirstValue(ClaimTypes.NameIdentifier) == comment.AppUser.Id))
                                                {
                                                    <form method="post" asp-action="DeleteBlogComment" asp-controller="Blog">
                                                        <input type="hidden" name="id" value="@comment.Id" />
                                                        <button type="submit" class="btn btn-danger">Delete</button>
                                                    </form>
                                                } *@
                                                @if (User.Identity.IsAuthenticated)
                                                {
                                                   <button class="reply-button" data-comment-id="@comment.Id">Replay</button>

                                                    <form  asp-action="ReplyComment" asp-controller="Blog" method="post">
                                                          <input type="hidden" name="ParentId" value="@comment.Id" />
                                                          <input type="hidden" name="ProductId" value="@Model.Blog.Id" />
                                                            <textarea name="Text" placeholder="Write a reply" required></textarea>
                                                            <div class="comment-replay">
                                                                  <button  type="submit">Replay</button>
                                                            </div>

                                                    </form>
                                                }
                                               
                                            </div>
                                        </div>
                                        <ul class="comments-replay">
                                            <li>
                                                <div class="single-comment d-sm-flex">
                                                    <div class="comment-author">
                                                        <img src="assets/images/comment-author.jpg" alt="author">
                                                    </div>
                                                    <div class="comment-content media-body">
                                                        <div class="comment-meta">
                                                            <h5 class="author-name">Admin</h5>
                                                            <span class="date">February 16, 2020 at 1:38 am</span>
                                                        </div>
                                                        <p>But I must explain to you how all this mistaken idea of denouncing pleasure</p>
                                                        <div class="comment-replay">
                                                            <a href="#">Replay</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    </li>
                              }
                             
                            </ul>
                       }
                        else
                        {
                            <p>No comments yet. Be the first to leave a reply!</p>
                        }
                      
                    </div>
                    <div class="blog-comment-form">
                        <h4 class="comment-title">Leave a Reply </h4>
                        <p>Your email address will not be published. Required fields are marked *</p>
                        @if (User.Identity.IsAuthenticated)
                        {
                            <div class="row">
                                <form id="commentForm" asp-action="CreateBlogComment" asp-route-BlogId="@Model.Blog.Id" method="post">
                                    <div class="col-md-12">
                                        <div class="single-form">
                                            <label>Your Review:</label>
                                            <textarea placeholder="Write a review"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="single-form">
                                            <label>Name:</label>
                                            <input type="text" placeholder="Name">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="single-form">
                                            <label>Email:</label>
                                            <input type="email" placeholder="Email">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="single-form">
                                            <label>Website:</label>
                                            <input type="email" placeholder="Email">
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="single-form">
                                            <button type="submit" class="main-btn">Post Comment</button>
                                        </div>
                                    </div>
                                </form>

                            </div>
                        }
                        else
                        {
                            <p>Please <a asp-controller="Account" asp-action="Login">Log in</a>to leave a comment.</p>
                        }

                    </div>
                </div>
            </div>

            <div class="col-lg-3">
                <div class="blog-sidebar">
                    <div class="sidebar-widget mt-30">
                        <h4 class="sidebar-title">Search</h4>
                        <div class="blog-sidebar-search">
                            <form action="#">
                                <input type="text" placeholder="Search">
                                <button><i class="fas fa-search"></i></button>
                            </form>
                        </div>
                    </div> <!-- sidebar widget -->

                    <div class="sidebar-widget mt-30">
                        <h4 class="sidebar-title">Categories</h4>
                        <div class="blog-sidebar-categories">
                            <ul class="categories-list">
                                <li><a href="blog-grid-left-sidebar.html">Dresses (20)</a></li>
                                <li><a href="blog-grid-left-sidebar.html">Jackets & Coats (9)</a></li>
                                <li><a href="blog-grid-left-sidebar.html">Sweaters (5)</a></li>
                                <li><a href="blog-grid-left-sidebar.html">Jeans (11)</a></li>
                                <li><a href="blog-grid-left-sidebar.html">Blouses & Shirts (3)</a></li>
                                <li><a href="blog-grid-left-sidebar.html">Electronic Cigarettes (6)</a></li>
                                <li><a href="blog-grid-left-sidebar.html">Bags & Cases (4)</a></li>
                            </ul>
                        </div>
                    </div> <!-- sidebar widget -->

                    <div class="sidebar-widget mt-30">
                        <h4 class="sidebar-title">Resent Post</h4>
                        <div class="blog-sidebar-post">

                            @foreach (var item in Model.RecentBlogs)
                            {
                                <div class="single-mini-post d-flex">
                                    <div class="post-thumb">
                                        <a href="blog-single-left-sidebar.html"><img src="@item.ImageUrl" alt="blog"></a>
                                    </div>
                                    <div class="post-content media-body">
                                        <h5 class="post-title"><a href="blog-single-left-sidebar.html">@item.Title</a></h5>
                                        <span class="date">@item.CreatedAt</span>
                                    </div>
                                </div>
                            }

                        </div>
                    </div> <!-- sidebar widget -->

                    <div class="sidebar-widget mt-30">
                        <h4 class="sidebar-title">Popular Tags</h4>
                        <div class="blog-sidebar-tags">
                            <ul class="tag-list">
                                @foreach (var item in Model.Blog.BlogTags)
                                {
                                    <li><a href="#">@item.Tag.Name</a></li>
                                }
                             
                            </ul>
                        </div>
                    </div>
                </div> <!-- blog sidebar -->
            </div>
        </div> <!-- row -->
    </div> <!-- container -->
</section>

<!--====== Blog Part Ends ======-->
@section Scripts {
    <script>
        document.querySelectorAll('.reply-button').forEach(button => {
            button.addEventListener('click', function() {
                const form = this.nextElementSibling;
                form.classList.toggle('d-none');
            });
        });
    </script>
}

